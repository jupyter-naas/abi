@prefix : <http://ontology.naas.ai/cyber-security/> .
@prefix intentMapping: <http://ontology.naas.ai/intentMapping/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix cse: <https://abi.cyber-security-events.org/ontology/> .
@prefix d3f: <http://d3fend.mitre.org/ontologies/d3fend.owl#> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .

# Competency Question 1: Digital Events - What digital artifacts participated in a given cyber event?
:cq1_digital_artifacts a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq1_digital_artifacts" ;
    intentMapping:intentDescription "CQ1 - Digital Events: What digital artifacts participated in a given cyber event?" ;
    intentMapping:sparqlTemplate """
PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX ex:   <http://example.org/cc#>

SELECT DISTINCT ?event ?eventType ?artifact ?artifactType
WHERE {
  # --- Event must be a Digital Event or CyberAction (or any of their subclasses) ---
  ?event rdf:type ?eventType .
  ?eventType rdfs:subClassOf* ?eventSuperClass .
  FILTER (?eventSuperClass IN (d3f:DigitalEvent, d3f:CyberAction)) .

  # --- Participation relation (d3f, cco, and inverses) ---
  {
    ?event d3f:hasParticipant ?artifact .
  }
  UNION
  {
    ?event cco:hasParticipant ?artifact .
  }
  UNION
  {
    ?artifact d3f:isParticipantIn ?event .
  }
  UNION
  {
    ?artifact cco:isParticipantIn ?event .
  }

  # --- Artifact must be subclass of relevant classes ---
  ?artifact rdf:type ?artifactType .
  ?artifactType rdfs:subClassOf* ?artifactSuperClass .
  FILTER (?artifactSuperClass IN (
      cco:Artifact,
      cco:InformationBearingEntity,
      d3f:Artifact,
      d3f:DigitalArtifact
  )) .
}
    """ .

# Competency Question 2: Which processes resulted in creation of files/payloads?
:cq2_file_creation_processes a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq2_file_creation_processes" ;
    intentMapping:intentDescription "CQ2 - Digital Events: Which processes or events resulted in the creation of a specific file, payload, or executable?" ;
    intentMapping:sparqlTemplate """
 PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?process ?processType ?artifact ?artifactType
WHERE {
  # --- Artifact (e.g., file, payload, executable) ---
  ?artifact rdf:type ?artifactType .
  ?artifactType rdfs:subClassOf* ?artifactSuperClass .
  FILTER (?artifactSuperClass IN (
      cco:Artifact,
      cco:InformationBearingEntity,
      d3f:Artifact,
      d3f:DigitalArtifact
  )) .

  # --- Process/Event that produced the artifact ---
  ?process (d3f:produces|cco:hasOutput|^d3f:produced-by|^cco:isOutputOf) ?artifact .

  # --- Process must be subclass of BOTH BFO:Process and d3f:Event ---
  ?process rdf:type ?processType .
  ?processType rdfs:subClassOf* bfo:BFO_0000015 .
  ?processType rdfs:subClassOf* d3f:Event .
}

    """ .

# Competency Question 3: Artifact generation
:cq3_artifact_generation a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq3_artifact_generation" ;
    intentMapping:intentDescription "CQ3 - Digital Events: Which artifacts or processes generated other artifacts (e.g., scripts producing payloads)?" ;
    intentMapping:sparqlTemplate """
        PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?producer ?producerType ?producedArtifact ?producedArtifactType ?process ?processType
WHERE {
  # --- Produced artifact ---
  ?producedArtifact rdf:type ?producedArtifactType .
  ?producedArtifactType rdfs:subClassOf* ?producedSuperClass .
  FILTER (?producedSuperClass IN (
      cco:Artifact,
      cco:InformationBearingEntity,
      d3f:Artifact,
      d3f:DigitalArtifact
  )) .

  # --- Producer artifact acting as agent in process ---
  ?producer rdf:type ?producerType .
  ?producerType rdfs:subClassOf* ?producerSuperClass .
  FILTER (?producerSuperClass IN (
      cco:Artifact,
      cco:InformationBearingEntity,
      d3f:Artifact,
      d3f:DigitalArtifact
  )) .

  # Artifact is an agent in or participates in the process
  ?producer (bfo:participatesIn | cco:agent_in | d3f:participate-in) ?process .

  # The process produced the artifact
  ?process (d3f:produces | ^d3f:produced-by | cco:hasOutput | ^cco:isOutputOf) ?producedArtifact .

  # --- Process must be either a BFO Process or a D3F Event ---
?process rdf:type ?processType .
{
  ?processType rdfs:subClassOf* bfo:BFO_0000015 .
}
UNION
{
  ?processType rdfs:subClassOf* d3f:Event .
}
    """ .

# Competency Question 4: Temporal sequence in attack chain
:cq4_temporal_sequence a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq4_temporal_sequence" ;
    intentMapping:intentDescription "CQ4 - Temporal Ordering: What is the temporal sequence of events in an attack chain?" ;
    intentMapping:sparqlTemplate """
PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>
 
SELECT DISTINCT ?event ?eventType ?nextEvent ?nextEventType ?technique
WHERE {
  # --- First event in chain ---
  # --- Attack stage / process ---
 ?attackStage rdf:type ?attackStageType .
{
  ?attackStageType rdfs:subClassOf* d3f:OffensiveAction .
}
UNION
{
  ?attackStageType rdfs:subClassOf* d3f:DigitalEvent .
}
  ?attackStage d3f:implements ?technique .
  ?technique rdfs:subClassOf* d3f:OffensiveTechnique .

  # --- Second event in chain ---
  ?nextEvent rdf:type ?nextEventType .
 ?attackStage rdf:type ?attackStageType .
{
  ?attackStageType rdfs:subClassOf* d3f:OffensiveAction .
}
UNION
{
  ?attackStageType rdfs:subClassOf* d3f:DigitalEvent .
}
  ?attackStage d3f:implements ?technique .
  ?technique rdfs:subClassOf* d3f:OffensiveTechnique .

  # --- Temporal ordering ---
  ?event (bfo:precedes | ^bfo:preceded_by | d3f:precedes | d3f:preceded-by) ?nextEvent .
}
ORDER BY ?event ?nextEvent

    """ .

# Competency Question 5: Temporally simultaneous or dependent processes
:cq5_temporal_dependencies a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq5_temporal_dependencies" ;
    intentMapping:intentDescription "CQ5 - Temporal Ordering: Which processes or events are temporally simultaneous with others?" ;
    intentMapping:sparqlTemplate """
        PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?subProcess ?subProcessType ?superProcess ?superProcessType
WHERE {
  # --- Sub-process or sub-event ---
  ?subProcess rdf:type ?subProcessType .
  {
    ?subProcessType rdfs:subClassOf* bfo:BFO_0000015 .
  }
  UNION
  {
    ?subProcessType rdfs:subClassOf* d3f:DigitalEvent .
  }

  # --- Super-process or containing event ---
  ?superProcess rdf:type ?superProcessType .
  {
    ?superProcessType rdfs:subClassOf* bfo:BFO_0000015 .
  }
  UNION
  {
    ?superProcessType rdfs:subClassOf* d3f:DigitalEvent .
  }

  # --- Temporal dependency via part-of structure ---
  ?subProcess (bfo:occurrent_part_of | ^bfo:has_occurrent_part | d3f:contains | ^d3f:contained-by) ?superProcess .
}
ORDER BY ?superProcess ?subProcess

    """ .

# Competency Question 6: Agent participation
:cq6_agent_participation a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq6_agent_participation" ;
    intentMapping:intentDescription "CQ6 - Agent Participation: Which agents executed or triggered a digital event?" ;
    intentMapping:sparqlTemplate """
        PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?agent ?agentType ?event ?eventType
WHERE {
  # --- Event ---
  ?event rdf:type ?eventType .
  {
    ?eventType rdfs:subClassOf* bfo:BFO_0000015 .
  }
  UNION
  {
    ?eventType rdfs:subClassOf* d3f:DigitalEvent .
  }
# --- Agent or system ---
?agent rdf:type ?agentType .
{
  ?agentType rdfs:subClassOf* cco:Agent .
}
UNION
{
  ?agentType rdfs:subClassOf* d3f:Agent .
}

  # --- Participation relation (agent executes or triggers event) ---
  ?agent (d3f:participates-in| ^d3f:has-participant | cco:agent_in | ^cco:has_agent) ?event .
}
ORDER BY ?event ?agent

    """ .

# Competency Question 7: Artifact lineage
:cq7_artifact_lineage a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq7_artifact_lineage" ;
    intentMapping:intentDescription "CQ7 - Artifact Lineage: Which artifacts were the targets or outputs of specific attack stages?" ;
    intentMapping:sparqlTemplate """
PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?artifact ?artifactType ?attackStage ?attackStageType ?role
WHERE {
  # --- Artifact ---
  ?artifact rdf:type ?artifactType .
  ?artifactType rdfs:subClassOf* ?artifactSuperClass .
  FILTER (?artifactSuperClass IN (
      cco:Artifact,
      cco:InformationBearingEntity,
      d3f:Artifact,
      d3f:DigitalArtifact
  )) .

  # --- Attack stage / process ---
 ?attackStage rdf:type ?attackStageType .
{
  ?attackStageType rdfs:subClassOf* d3f:OffensiveAction .
}
UNION
{
  ?attackStageType rdfs:subClassOf* d3f:DigitalEvent .
}
  ?attackStage d3f:implements ?technique .
  ?technique rdfs:subClassOf* d3f:OffensiveTechnique .

  # --- Artifact is output of OR target of the attack stage ---
  {
    ?artifact (d3f:produced-by | ^d3f:produces | cco:isOutputOf | ^cco:hasOutput) ?attackStage .
    BIND("output" AS ?role)
  }
  UNION
  {
    ?attackStage (d3f:hasParticipant | cco:hasParticipant | d3f:has-agent | cco:hasAgent | ^cco:agentIn ) ?artifact .
    BIND("target" AS ?role)
  }
}
ORDER BY ?attackStage ?artifact
 
    """ .


# Competency Question 23: Techniques and Goals
:cq9_infrastructure a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq23_high_level" ;
    intentMapping:intentDescription "What are the high-level goals that an attacker is trying to achieve with this lower-level tactic?" ;
    intentMapping:sparqlTemplate """
PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?agent ?agentType ?action ?actionType ?technique ?techType ?tactic ?tacticType
WHERE {
# --- Agent ---
?agent rdf:type ?agentType .
{
  ?agentType rdfs:subClassOf* d3f:Agent .
}
UNION
{
  ?agentType rdfs:subClassOf* cco:Agent .
}

  # --- Offensive Action ---
  ?action rdf:type ?actionType .
  ?actionType rdfs:subClassOf* d3f:OffensiveAction .

  # Agent participates in the action
  ?agent (bfo:participatesIn | d3f:has-agent | cco:agentIn | ^cco:hasAgent) ?action .

  # --- Technique implemented by action ---
  ?action (d3f:implements | ^d3f:implemented-by) ?technique .
  ?technique rdf:type ?techType .
  ?techType rdfs:subClassOf* d3f:OffensiveTechnique .

  # --- Tactic enabled by technique ---
  ?technique d3f:enables ?tactic .
  ?tactic rdf:type ?tacticType .
  ?tacticType rdfs:subClassOf* d3f:OffensiveTactic .
}
ORDER BY ?agent ?action ?technique ?tactic

    """ .

# Competency Question 10: Network events correlated with malicious artifacts
:cq10_network_correlation a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq10_network_correlation" ;
    intentMapping:intentDescription "CQ10 - Infrastructure: Which network events were correlated with malicious artifacts or payloads?" ;
    intentMapping:sparqlTemplate """
PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?networkEvent ?networkEventType ?artifact ?artifactType ?relation ?offensiveAction
WHERE {
  # --- Network event ---
  ?networkEvent rdf:type ?networkEventType .
  {
    ?networkEventType rdfs:subClassOf* d3f:NetworkEvent .
  }

  # --- Artifact / payload ---
  ?artifact rdf:type ?artifactType .
  ?artifactType rdfs:subClassOf* ?artifactSuperClass .
  FILTER (?artifactSuperClass IN (
      cco:Artifact,
      cco:InformationBearingEntity,
      d3f:Artifact,
      d3f:DigitalArtifact
  )) .

  # --- Artifact participates in an OffensiveAction ---
  ?artifact (d3f:participatesIn | cco:participatesIn | ^cco:hasParticipant) ?offensiveAction .
  ?offensiveAction rdf:type ?offensiveActionType .
  ?offensiveActionType rdfs:subClassOf* d3f:OffensiveAction .

  # --- Correlation relations ---
  {
    ?networkEvent (d3f:hasParticipant | cco:hasParticipant) ?artifact .
    BIND("participant" AS ?relation)
  }
  UNION
  {
    ?networkEvent (d3f:produces | ^d3f:produced-by | cco:hasOutput | ^cco:isOutputOf) ?artifact .
    BIND("produces/consumes" AS ?relation)
  }
}
ORDER BY ?networkEvent ?artifact
    """ .

# Competency Question 21: Correlation with physical-world entities
:cq21_physical_correlation a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "cq21_physical_correlation" ;
    intentMapping:intentDescription "CQ21 - Cross-Domain Context: Can we correlate digital events with physical-world entities (e.g., systems, personnel,...)?" ;
    intentMapping:sparqlTemplate """
        PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX d3f:  <http://d3fend.mitre.org/ontologies/d3fend.owl#>
PREFIX cco:  <http://www.ontologyrepository.com/CommonCoreOntologies/>
PREFIX bfo:  <http://purl.obolibrary.org/obo/>

SELECT DISTINCT ?digitalEvent ?digitalEventType ?materialentity ?entityType ?relation
WHERE {
  # --- Digital Event ---
  ?digitalEvent rdf:type ?digitalEventType .
  {
    ?digitalEventType rdfs:subClassOf* d3f:DigitalEvent .
  }
  UNION
  {
    ?digitalEventType rdfs:subClassOf* bfo:BFO_0000015 .
  }

  # --- Physical-world Entity ---
  ?materialentity rdf:type ?entityType .
  {
    ?entityType rdfs:subClassOf* bfo:MaterialEntity .
  }
   UNION
  {
    ?entityType rdfs:subClassOf* d3f:Agent .
  }
   UNION
  {
    ?entityType rdfs:subClassOf* d3f:Artifact .
  }

  # --- Participation / involvement relation ---
  {
    ?entity (bfo:participatesIn | cco:agent_in | ^cco:has_agent | cco:hasParticipant | d3f:hasAgent) ?digitalEvent .
    BIND("participant/agent" AS ?relation)
  }
}
ORDER BY ?digitalEvent ?entity

    """ .

