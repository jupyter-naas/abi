@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dc11: <http://purl.org/dc/elements/1.1/> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix cco: <https://www.commoncoreontologies.org/> .
@prefix intentMapping: <http://ontology.naas.ai/intentMapping/> .

intentMapping:searchPersonQuery a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "searchPersonQuery"@en ;
    intentMapping:intentDescription "Search for persons in the ontology based on their name, with exact and partial matching" ;
    intentMapping:sparqlTemplate """
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT DISTINCT ?class_uri ?individual_uri ?label (MAX(?temp_score) AS ?score)
        WHERE {
            # Filter On Class URI and ensure individual is a NamedIndividual
            ?individual_uri a ?class_uri ;
                            a owl:NamedIndividual ;
                            rdfs:label ?label .
            FILTER(?class_uri = <https://www.commoncoreontologies.org/ont00001262>)
            
            # Calculate scores for perfect and partial matches
            BIND(IF(LCASE(STR(?label)) = LCASE("{{ search_label }}"), 10, 0) AS ?perfect_score)
            BIND(IF(CONTAINS(LCASE(STR(?label)), LCASE("{{ search_label }}")), 8, 0) AS ?partial_score)
            
            # Use the higher of the two scores
            BIND(IF(?perfect_score > ?partial_score, ?perfect_score, ?partial_score) AS ?temp_score)
            
            # Only include results with a score > 0
            FILTER(?temp_score > 0)
        }
        GROUP BY ?class_uri ?individual_uri ?label
        ORDER BY DESC(?score) ?label
    """ ;
    intentMapping:hasArgument intentMapping:searchLabelArg .

intentMapping:searchLabelArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "search_label" ;
    intentMapping:argumentDescription "The name or partial name of the person to search for" ;
    intentMapping:validationPattern "^[a-zA-Z0-9\\s-]{1,100}$" ;
    intentMapping:validationFormat "person_name" .


