<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABI Knowledge Graph Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    
    <style>
        :root {
            --sf-pro: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            --primary-blue: #007AFF;
            --secondary-gray: #8E8E93;
            --background-white: #FFFFFF;
            --background-gray: #F2F2F7;
            --text-primary: #000000;
            --text-secondary: #3C3C43;
            --border-light: #E5E5EA;
            --shadow-light: rgba(0, 0, 0, 0.05);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            background: var(--background-white);
            color: var(--text-primary);
            font-family: var(--sf-pro);
            line-height: 1.47;
            font-size: 17px;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--border-light);
            padding: 12px 0;
        }
        
        .navbar-brand {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
        }
        
        .nav-link {
            color: var(--text-secondary) !important;
            font-weight: 400;
            font-size: 17px;
            padding: 8px 16px !important;
            border-radius: 12px;
            transition: all 0.2s ease;
            margin: 0 4px;
        }
        
        .nav-link:hover {
            color: var(--primary-blue) !important;
            background: rgba(0, 122, 255, 0.08);
        }
        
        .nav-link.active {
            color: var(--primary-blue) !important;
            background: rgba(0, 122, 255, 0.12);
            font-weight: 500;
        }
        
        .content-area {
            padding: 0;
            min-height: calc(100vh - 80px);
            margin-top: 80px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .dashboard-container {
            background: var(--background-white);
            padding: 48px 32px;
            margin: 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .stats-card {
            background: var(--background-white);
            border-radius: 20px;
            padding: 32px 24px;
            border: 1px solid var(--border-light);
            transition: transform 0.2s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 8px;
            line-height: 1.1;
        }
        
        .stat-label {
            font-size: 15px;
            font-weight: 500;
            color: var(--secondary-gray);
            text-transform: none;
            letter-spacing: 0;
        }
        
        .feature-card {
            background: var(--background-white);
            border-radius: 20px;
            padding: 32px 24px;
            border: 1px solid var(--border-light);
            transition: transform 0.2s ease;
            height: 100%;
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow-light);
        }
        
        .feature-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: var(--primary-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 0 24px 0;
            color: white;
            font-size: 24px;
        }
        
        .feature-card h4 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        
        .feature-card p {
            color: var(--text-secondary);
            font-size: 17px;
            line-height: 1.4;
            margin-bottom: 24px;
        }
        
        .btn-feature {
            background: var(--primary-blue);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 17px;
            transition: all 0.2s ease;
            text-transform: none;
            letter-spacing: 0;
        }
        
        .btn-feature:hover {
            background: #0056b3;
            transform: translateY(-1px);
            color: white;
        }
        
        .query-editor-container {
            display: flex;
            height: calc(100vh - 80px);
            margin-top: 0;
            position: relative;
        }
        
        .query-library-panel {
            width: 350px;
            background: var(--background-gray);
            border-left: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, width 0.3s ease;
            z-index: 10;
            order: 2;
        }
        
        .query-library-panel.collapsed {
            transform: translateX(100%);
            width: 0;
        }
        
        .library-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-light);
            background: var(--background-white);
            display: flex;
            align-items: center;
            justify-content: between;
        }
        
        .library-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }
        
        .collapse-btn {
            background: none;
            border: none;
            color: var(--secondary-gray);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .collapse-btn:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }
        
        .library-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px;
        }
        
        .library-toggle {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
        }
        
        .toggle-btn {
            background: var(--primary-blue);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
            transition: all 0.2s ease;
        }
        
        .toggle-btn:hover {
            background: #0056b3;
        }
        
        .yasgui-container {
            flex: 1;
            position: relative;
            order: 1;
            min-width: 0;
        }
        
        .yasgui-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            background: var(--background-white);
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-gray);
            font-size: 14px;
        }
        
        .query-tiles {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .query-tile {
            background: var(--background-white);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .query-tile:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .query-tile.active {
            border-color: var(--primary-blue);
            background: rgba(0, 122, 255, 0.08);
            transform: scale(0.98);
        }
        
        .query-tile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .query-tile-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .query-tile-category {
            background: var(--primary-blue);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .query-tile-question {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .query-tile-description {
            font-size: 13px;
            color: var(--secondary-gray);
            line-height: 1.3;
        }
        
        .query-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }
        
        .no-selection {
            text-align: center;
            color: var(--secondary-gray);
            margin-top: 120px;
        }
        
        .no-selection i {
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .no-selection h4 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .no-selection p {
            font-size: 17px;
            line-height: 1.4;
        }
        
        .query-detail {
            max-width: 800px;
        }
        
        .query-detail-header {
            margin-bottom: 32px;
        }
        
        .query-detail-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .query-detail-question {
            font-size: 18px;
            color: var(--primary-blue);
            font-weight: 500;
            margin-bottom: 16px;
        }
        
        .query-detail-description {
            font-size: 17px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 16px;
        }
        
        .query-detail-why {
            background: rgba(52, 199, 89, 0.08);
            border: 1px solid rgba(52, 199, 89, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 32px;
        }
        
        .query-detail-why strong {
            color: #34C759;
            font-weight: 600;
        }
        
        .query-code-section {
            margin-bottom: 32px;
        }
        
        .query-code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .query-code-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .copy-query-btn {
            background: var(--background-gray);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .copy-query-btn:hover {
            background: var(--border-light);
        }
        
        .query-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn-execute-large {
            background: var(--primary-blue);
            border: none;
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 17px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .btn-execute-large:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-open-editor {
            background: var(--background-white);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 17px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .btn-open-editor:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }
        
        .query-card {
            background: var(--background-white);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        
        .query-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow-light);
        }
        
        .query-card .card-header {
            background: var(--background-gray);
            border-bottom: 1px solid var(--border-light);
            padding: 20px 24px;
        }
        
        .query-card .card-header h6 {
            font-size: 17px;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
        }
        
        .query-card .card-body {
            padding: 24px;
        }
        
        .category-badge {
            background: var(--primary-blue);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            text-transform: none;
            letter-spacing: 0;
        }
        
        .btn-execute {
            background: var(--primary-blue);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 17px;
            transition: all 0.2s ease;
        }
        
        .btn-execute:hover {
            background: #0056b3;
            color: white;
        }
        
        .iframe-container {
            position: relative;
            height: calc(100vh - 200px);
            border-radius: 20px;
            overflow: hidden;
            margin: 20px;
            border: 1px solid var(--border-light);
            background: white;
        }
        
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .loading-overlay.hidden {
            display: none !important;
        }
        
        .modal-content {
            background: var(--background-white);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
            border-radius: 20px;
        }
        
        .modal-header {
            border-bottom: 1px solid var(--border-light);
            padding: 24px 24px 20px;
        }
        
        .modal-body {
            padding: 20px 24px;
        }
        
        .modal-footer {
            border-top: 1px solid var(--border-light);
            padding: 20px 24px 24px;
        }
        
        pre code {
            font-size: 14px;
            line-height: 1.5;
            font-family: 'SF Mono', Menlo, Monaco, monospace;
        }
        
        .table {
            --bs-table-bg: transparent;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .table thead th {
            background: var(--background-gray);
            border-bottom: 1px solid var(--border-light);
            font-weight: 600;
            color: var(--text-primary);
            padding: 16px;
        }
        
        .table tbody td {
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .table-hover tbody tr:hover {
            background: rgba(0, 122, 255, 0.04);
        }
        
        .alert {
            border-radius: 12px;
            border: 1px solid var(--border-light);
            padding: 16px 20px;
        }
        
        .alert-info {
            background: rgba(0, 122, 255, 0.08);
            color: var(--primary-blue);
            border-color: rgba(0, 122, 255, 0.2);
        }
        
        .text-primary {
            color: var(--primary-blue) !important;
        }
        
        .text-success {
            color: #34C759 !important;
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 20px;
            }
            
            .query-editor-container {
                flex-direction: column-reverse;
                margin-top: 70px;
                height: calc(100vh - 70px);
            }
            
            .query-library-panel {
                width: 100%;
                height: 250px;
                border-left: none;
                border-top: 1px solid var(--border-light);
                order: 2;
            }
            
            .query-library-panel.collapsed {
                transform: translateY(100%);
                height: 0;
            }
            
            .library-toggle {
                top: 10px;
                right: 50%;
                transform: translateX(50%);
            }
            
            .toggle-btn {
                border-radius: 8px;
                width: 50px;
                height: 30px;
            }
            
            .query-tiles {
                max-height: 180px;
            }
            
            .yasgui-container {
                flex: 1;
                order: 1;
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-project-diagram me-2"></i>
                ABI Knowledge Explorer
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="switchTab('dashboard'); return false;" data-tab="dashboard">
                            <i class="fas fa-home"></i> Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#yasgui" onclick="switchTab('yasgui'); return false;" data-tab="yasgui">
                            <i class="fas fa-search"></i> Query Editor
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Content Area -->
    <div class="content-area">
        <div class="tab-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-pane active">
                <div class="dashboard-container">
                    <div class="row">
                        <div class="col-12 text-center mb-5">
                        </div>
                        
                        <!-- Stats Cards -->
                        <div class="col-md-3 mb-4">
                            <div class="stats-card text-center">
                                <div class="stat-number" id="tripleCount">15,081</div>
                                <div class="stat-label">Total Triples</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="stats-card text-center">
                                <div class="stat-number" id="classCount">156</div>
                                <div class="stat-label">OWL Classes</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="stats-card text-center">
                                <div class="stat-number" id="propertyCount">89</div>
                                <div class="stat-label">Data Properties</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="stats-card text-center">
                                <div class="stat-number" id="objectPropertyCount">34</div>
                                <div class="stat-label">Object Properties</div>
                            </div>
                        </div>
                        
                        <!-- Feature Cards -->
                        <div class="col-md-6 mb-4">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <h4>Query Editor</h4>
                                <p class="text-muted mb-4">Full-featured SPARQL editor with YasGUI - syntax highlighting, auto-completion, result visualization, and export options.</p>
                                <button class="btn btn-feature" onclick="switchTab('yasgui')">
                                    <i class="fas fa-edit"></i> Start Querying
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- YasGUI Tab with Integrated Query Library -->
            <div id="yasgui" class="tab-pane">
                <div class="query-editor-container">
                    <!-- Collapsible Query Library Side Panel -->
                    <div class="query-library-panel" id="queryLibraryPanel">
                        <div class="library-header">
                            <div class="library-title">
                                <i class="fas fa-bookmark"></i>
                                <span>Query Library</span>
                            </div>
                            <button class="collapse-btn" onclick="toggleQueryLibrary()">
                                <i class="fas fa-chevron-right" id="collapseIcon"></i>
                            </button>
                        </div>
                        <div class="library-content">
                            <div class="search-container">
                                <input type="text" id="querySearch" class="search-input" placeholder="Search queries..." onkeyup="filterQueries()">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <div class="query-tiles" id="queryTiles">
                                <!-- Query tiles will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Toggle Button (when collapsed) -->
                    <div class="library-toggle" id="libraryToggle" style="display: none;">
                        <button class="toggle-btn" onclick="toggleQueryLibrary()">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                    
                    <!-- YasGUI iframe -->
                    <div class="yasgui-container">
                        <div class="loading-overlay" id="yasguiLoading">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading SPARQL Editor...</p>
                            </div>
                        </div>
                        <iframe id="yasguiFrame" src="/yasgui/" frameborder="0" onload="document.getElementById('yasguiLoading').style.display='none'"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal fade" id="resultsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Query Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="modalResults">
                        <!-- Results will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="openInYasgui()">Open in Query Editor</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        let currentQuery = '';
        let currentTab = 'dashboard';
        
        const queries = {
            'overview': `SELECT DISTINCT ?type (COUNT(*) AS ?count) WHERE {
    ?s a ?type
} GROUP BY ?type ORDER BY DESC(?count)`,
            
            'hierarchy': `PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?class ?label WHERE {
    ?class a owl:Class .
    OPTIONAL { ?class rdfs:label ?label }
    FILTER NOT EXISTS { ?class rdfs:subClassOf ?parent }
} ORDER BY ?label LIMIT 20`,

            'properties': `PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?property ?label ?domain ?range WHERE {
    ?property a owl:ObjectProperty .
    OPTIONAL { ?property rdfs:label ?label }
    OPTIONAL { ?property rdfs:domain ?domain }
    OPTIONAL { ?property rdfs:range ?range }
} ORDER BY ?label LIMIT 20`,

            'abi': `PREFIX abi: <http://ontology.naas.ai/abi#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?entity ?type ?label WHERE {
    ?entity ?p ?o .
    FILTER(STRSTARTS(STR(?entity), "http://ontology.naas.ai/abi"))
    OPTIONAL { ?entity a ?type }
    OPTIONAL { ?entity rdfs:label ?label }
} LIMIT 30`,

            'intent': `PREFIX intent: <http://ontology.naas.ai/intentMapping#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?intent ?label ?description WHERE {
    ?intent ?p ?o .
    FILTER(STRSTARTS(STR(?intent), "http://ontology.naas.ai/intentMapping"))
    OPTIONAL { ?intent rdfs:label ?label }
    OPTIONAL { ?intent rdfs:comment ?description }
} LIMIT 20`,

            'namespace': `SELECT ?namespace (COUNT(*) AS ?triples) WHERE {
    ?s ?p ?o .
    BIND(REPLACE(STR(?s), "(#|/)[^#/]*$", "$1") AS ?namespace)
} GROUP BY ?namespace ORDER BY DESC(?triples)`
        };

        const templateData = [
            {
                id: 'overview',
                question: 'What types of data do I have in my knowledge graph?',
                name: 'ðŸ“Š Data Overview',
                description: 'Show all entity types and their counts',
                category: 'Analytics',
                query: queries.overview,
                why: 'Perfect starting point to understand what kinds of entities exist in your knowledge graph'
            },
            {
                id: 'hierarchy',
                question: 'How is my ontology structured in terms of classes?',
                name: 'ðŸ—ï¸ Class Hierarchy',
                description: 'Show top-level OWL classes in the ontology',
                category: 'Structure',
                query: queries.hierarchy,
                why: 'Essential for understanding the conceptual framework and relationships in your data model'
            },
            {
                id: 'properties',
                question: 'What properties connect my entities and how?',
                name: 'ðŸ”— Property Relations',
                description: 'Explore object properties and their domains/ranges',
                category: 'Structure',
                query: queries.properties,
                why: 'Critical for understanding how different entities are related and what data patterns exist'
            },
            {
                id: 'abi',
                question: 'What ABI-specific components exist in my system?',
                name: 'ðŸ‘¥ ABI Entities',
                description: 'Show ABI-specific entities and components',
                category: 'System',
                query: queries.abi,
                why: 'Helps you monitor and understand your ABI system architecture and data flow'
            },
            {
                id: 'intent',
                question: 'How does the intent mapping system work?',
                name: 'ðŸ§  Intent Mapping',
                description: 'Explore intent mapping system components',
                category: 'System',
                query: queries.intent,
                why: 'Key to understanding how ABI processes and maps user intents to system actions'
            },
            {
                id: 'namespace',
                question: 'How is my data distributed across different sources?',
                name: 'ðŸŒ Namespace Analysis',
                description: 'Analyze data distribution across namespaces',
                category: 'Analytics',
                query: queries.namespace,
                why: 'Important for data governance and understanding where your information comes from'
            }
        ];

        function switchTab(tabName) {
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            currentTab = tabName;
            
            // Update URL hash for bookmarking
            if (tabName !== 'dashboard') {
                window.history.pushState(null, null, `#${tabName}`);
            } else {
                window.history.pushState(null, null, window.location.pathname);
            }
            
            // Load content for specific tabs
            if (tabName === 'yasgui') {
                loadQueryLibrary();
            }
        }

        function loadFromUrl() {
            const hash = window.location.hash.replace('#', '');
            if (hash && ['yasgui'].includes(hash)) {
                switchTab(hash);
            } else {
                switchTab('dashboard');
            }
        }

        function loadYasgui() {
            const frame = document.getElementById('yasguiFrame');
            const loading = document.getElementById('yasguiLoading');
            
            console.log('Starting to load YasGUI iframe...');
            
            // Set iframe src to load YasGUI through proxy (same origin)
            frame.src = '/yasgui/';
            
            // Handle iframe load events
            frame.onload = function() {
                console.log('YasGUI iframe loaded successfully');
                loading.style.display = 'none';
            };
            
            frame.onerror = function() {
                console.error('YasGUI iframe failed to load');
                loading.innerHTML = `
                    <div class="text-center">
                        <p class="text-danger">Failed to load Query Editor</p>
                        <button class="btn btn-primary" onclick="window.open('/yasgui/', '_blank')">
                            Open in New Tab
                        </button>
                    </div>
                `;
            };
            
            // More aggressive timeout fallback
            setTimeout(() => {
                console.log('YasGUI iframe loading timeout, hiding overlay');
                loading.style.display = 'none';
            }, 3000);
        }

        function loadQueryLibrary() {
            const tilesContainer = document.getElementById('queryTiles');
            if (tilesContainer.children.length > 0) return; // Already loaded
            
            templateData.forEach(template => {
                const tile = document.createElement('div');
                tile.className = 'query-tile';
                tile.setAttribute('data-query-id', template.id);
                tile.setAttribute('data-searchable', `${template.name} ${template.question} ${template.description} ${template.category}`.toLowerCase());
                
                tile.innerHTML = `
                    <div class="query-tile-header">
                        <div class="query-tile-title">${template.name}</div>
                        <div class="query-tile-category">${template.category}</div>
                    </div>
                    <div class="query-tile-question">${template.question}</div>
                    <div class="query-tile-description">${template.description}</div>
                `;
                
                tile.onclick = () => openQueryInYasGUI(template.id);
                tilesContainer.appendChild(tile);
            });
        }
        
        function toggleQueryLibrary() {
            const panel = document.getElementById('queryLibraryPanel');
            const toggle = document.getElementById('libraryToggle');
            const icon = document.getElementById('collapseIcon');
            
            if (panel.classList.contains('collapsed')) {
                // Show panel
                panel.classList.remove('collapsed');
                toggle.style.display = 'none';
                icon.className = 'fas fa-chevron-right';
            } else {
                // Hide panel
                panel.classList.add('collapsed');
                toggle.style.display = 'block';
                icon.className = 'fas fa-chevron-left';
            }
        }
        
        function openQueryInYasGUI(templateId) {
            const template = templateData.find(t => t.id === templateId);
            if (!template) return;
            
            // Get the YasGUI iframe
            const iframe = document.getElementById('yasguiFrame');
            
            try {
                // Try to communicate with YasGUI to create a new tab with the query
                // This requires YasGUI to be loaded and accessible
                if (iframe && iframe.contentWindow) {
                    // Create a new YasGUI tab with the query
                    const yasguiUrl = `/yasgui/?query=${encodeURIComponent(template.query)}&queryName=${encodeURIComponent(template.name)}`;
                    
                    // Option 1: Open in new browser tab (most reliable)
                    window.open(yasguiUrl, '_blank');
                    
                    // Option 2: Try to update current iframe (fallback)
                    // iframe.src = yasguiUrl;
                }
            } catch (error) {
                console.error('Error opening query in YasGUI:', error);
                // Fallback: open in new tab
                const yasguiUrl = `/yasgui/?query=${encodeURIComponent(template.query)}`;
                window.open(yasguiUrl, '_blank');
            }
            
            // Visual feedback
            const tiles = document.querySelectorAll('.query-tile');
            tiles.forEach(tile => tile.classList.remove('active'));
            document.querySelector(`[data-query-id="${templateId}"]`).classList.add('active');
            
            setTimeout(() => {
                document.querySelector(`[data-query-id="${templateId}"]`).classList.remove('active');
            }, 1000);
        }
        
        function filterQueries() {
            const searchTerm = document.getElementById('querySearch').value.toLowerCase();
            const tiles = document.querySelectorAll('.query-tile');
            
            tiles.forEach(tile => {
                const searchableText = tile.getAttribute('data-searchable');
                if (searchableText.includes(searchTerm)) {
                    tile.style.display = 'block';
                } else {
                    tile.style.display = 'none';
                }
            });
        }
        


        function executeQuery(templateId) {
            const template = templateData.find(t => t.id === templateId);
            if (!template) return;
            
            currentQuery = template.query;
            
            // Show loading in modal
            const modal = new bootstrap.Modal(document.getElementById('resultsModal'));
            const modalResults = document.getElementById('modalResults');
            modalResults.innerHTML = `
                <div class="text-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Executing query...</p>
                </div>
            `;
            modal.show();
            
            // Execute the query
            const encodedQuery = encodeURIComponent(template.query);
            fetch(`http://localhost:7878/query?query=${encodedQuery}`)
                .then(response => response.json())
                .then(data => {
                    displayResults(data, modalResults);
                })
                .catch(error => {
                    modalResults.innerHTML = `
                        <div class="alert alert-danger">
                            <h6>Query Error</h6>
                            <p>${error.message}</p>
                        </div>
                    `;
                });
        }

        function displayResults(data, container) {
            const vars = data.head.vars;
            const bindings = data.results.bindings;
            
            if (bindings.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No results found</div>';
                return;
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
            `;
            
            vars.forEach(varName => {
                html += `<th>${varName.charAt(0).toUpperCase() + varName.slice(1)}</th>`;
            });
            
            html += '</tr></thead><tbody>';
            
            bindings.slice(0, 100).forEach(binding => {
                html += '<tr>';
                vars.forEach(varName => {
                    const value = binding[varName];
                    if (value) {
                        let displayValue = value.value;
                        if (value.type === 'uri') {
                            const parts = displayValue.split(/[#\/]/);
                            const shortName = parts[parts.length - 1];
                            displayValue = shortName || displayValue;
                        }
                        if (displayValue.length > 50) {
                            displayValue = displayValue.substring(0, 47) + '...';
                        }
                        html += `<td title="${value.value}">${displayValue}</td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                });
                html += '</tr>';
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <small class="text-muted">
                        Showing ${Math.min(bindings.length, 100)} of ${bindings.length} results
                    </small>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function openInYasgui() {
            const yasguiUrl = `/yasgui/?query=${encodeURIComponent(currentQuery)}`;
            window.open(yasguiUrl, '_blank');
        }



        function formatLabel(uri) {
            const parts = uri.replace('#', '/').split('/');
            let label = parts[parts.length - 1] || uri;
            
            // Handle camelCase
            label = label.replace(/([a-z])([A-Z])/g, '$1 $2');
            
            // Limit length
            if (label.length > 20) {
                label = label.substring(0, 17) + '...';
            }
            
            return label;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load dashboard stats
            loadDashboardStats();
            
            // Load from URL hash if present
            loadFromUrl();
        });

        // Handle browser back/forward buttons
        window.addEventListener('hashchange', loadFromUrl);

        function loadDashboardStats() {
            // Update triple count dynamically
            fetch('http://localhost:7878/query?query=' + encodeURIComponent('SELECT (COUNT(*) AS ?count) WHERE { ?s ?p ?o }'))
                .then(response => response.json())
                .then(data => {
                    if (data.results.bindings.length > 0) {
                        const count = data.results.bindings[0].count.value;
                        document.getElementById('tripleCount').textContent = parseInt(count).toLocaleString();
                    }
                })
                .catch(error => console.error('Error loading triple count:', error));

            // Update class count
            fetch('http://localhost:7878/query?query=' + encodeURIComponent('PREFIX owl: <http://www.w3.org/2002/07/owl#> SELECT (COUNT(DISTINCT ?class) AS ?count) WHERE { ?class a owl:Class }'))
                .then(response => response.json())
                .then(data => {
                    if (data.results.bindings.length > 0) {
                        const count = data.results.bindings[0].count.value;
                        document.getElementById('classCount').textContent = parseInt(count).toLocaleString();
                    }
                })
                .catch(error => console.error('Error loading class count:', error));

            // Update property counts
            fetch('http://localhost:7878/query?query=' + encodeURIComponent('PREFIX owl: <http://www.w3.org/2002/07/owl#> SELECT (COUNT(DISTINCT ?prop) AS ?count) WHERE { ?prop a owl:DatatypeProperty }'))
                .then(response => response.json())
                .then(data => {
                    if (data.results.bindings.length > 0) {
                        const count = data.results.bindings[0].count.value;
                        document.getElementById('propertyCount').textContent = parseInt(count).toLocaleString();
                    }
                })
                .catch(error => console.error('Error loading data property count:', error));

            fetch('http://localhost:7878/query?query=' + encodeURIComponent('PREFIX owl: <http://www.w3.org/2002/07/owl#> SELECT (COUNT(DISTINCT ?prop) AS ?count) WHERE { ?prop a owl:ObjectProperty }'))
                .then(response => response.json())
                .then(data => {
                    if (data.results.bindings.length > 0) {
                        const count = data.results.bindings[0].count.value;
                        document.getElementById('objectPropertyCount').textContent = parseInt(count).toLocaleString();
                    }
                })
                .catch(error => console.error('Error loading object property count:', error));
        }
    </script>
</body>
</html>