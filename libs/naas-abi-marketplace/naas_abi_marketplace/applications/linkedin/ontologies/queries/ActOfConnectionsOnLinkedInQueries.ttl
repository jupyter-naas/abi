@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dc11: <http://purl.org/dc/elements/1.1/> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix cco: <https://www.commoncoreontologies.org/> .
@prefix abi: <http://ontology.naas.ai/abi/> .
@prefix linkedin: <http://ontology.naas.ai/abi/linkedin/> .
@prefix intentMapping: <http://ontology.naas.ai/intentMapping/> .

########################################################
# LinkedIn Act of Connections Queries
########################################################

# Count the number of LinkedIn connections for a person (by URI)
intentMapping:LinkedInCountConnectionsByPerson a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_count_connections_by_person"@en ;
    intentMapping:intentDescription "Count the number of LinkedIn connections for a person, using their URI." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT (COUNT(DISTINCT ?connectedPerson) AS ?connectionCount)
        WHERE {
          BIND(<{{ person_uri }}> AS ?thePerson)
          ?thePerson a cco:ont00001262 .

          ?connection a linkedin:ActOfConnection ;
                      linkedin:involvesAgent ?thePerson , ?connectedPerson .
          ?connectedPerson a cco:ont00001262 .
          FILTER(?connectedPerson != ?thePerson)
        }
    """ ;
    intentMapping:hasArgument intentMapping:personUriArg .

# Search all persons connected to a specific person by URI
intentMapping:LinkedInSearchConnectionsByPerson a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_connections_by_person"@en ;
    intentMapping:intentDescription "Search for LinkedIn connections where at least one person is connected to a specific person (using person URI). Returns connection URIs, connected date, and person information." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT DISTINCT 
            ?connection 
            ?connectedPerson 
            ?connectedPersonName 
            ?connectedAt 
            ?currentJobPositionValue 
            ?currentOrganizationValue 
            ?currentPublicUrlValue 
            ?emailAddressValue
        WHERE {
          BIND(<{{ person_uri }}> AS ?thePerson)
          ?thePerson a cco:ont00001262 .

          ?connection a linkedin:ActOfConnection ;
                      linkedin:involvesAgent ?thePerson ;
                      linkedin:involvesAgent ?connectedPerson ;
                      linkedin:connectedAt ?connectedAtURI.

          ?connectedAtURI rdfs:label ?connectedAt .

          FILTER(?connectedPerson != ?thePerson)

          ?connectedPerson a cco:ont00001262 ;
                           rdfs:label ?connectedPersonName .

          OPTIONAL {
            ?connectedPerson linkedin:hasCurrentJobPosition ?currentJobPosition .
            ?currentJobPosition a linkedin:CurrentJobPosition ;
                               rdfs:label ?currentJobPositionValue .
          }
          OPTIONAL {
            ?connectedPerson linkedin:hasCurrentOrganization ?currentOrganization .
            ?currentOrganization a linkedin:CurrentOrganization ;
                                rdfs:label ?currentOrganizationValue .
          }
          OPTIONAL {
            ?connectedPerson linkedin:hasCurrentPublicUrl ?currentPublicUrl .
            ?currentPublicUrl a linkedin:CurrentPublicUrl ;
                              rdfs:label ?currentPublicUrlValue .
          }
          OPTIONAL {
            ?connectedPerson linkedin:hasEmailAddress ?emailAddress .
            ?emailAddress a linkedin:EmailAddress ;
                          rdfs:label ?emailAddressValue .
          }
        }

        ORDER BY DESC(?connectedAt)
        LIMIT {{ limit|default(50) }}
        OFFSET {{ offset|default(0) }}
    """ ;
    intentMapping:hasArgument intentMapping:personUriArg , intentMapping:limitArg , intentMapping:offsetArg .

# Search connections by organization (by organization URI)
intentMapping:LinkedInSearchConnectionsByOrganization a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_connections_by_organization"@en ;
    intentMapping:intentDescription "Search for LinkedIn connections where at least one person works at a specific organization (using organization URI). Returns connection URIs, connected date, and person information." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>
        PREFIX bfo: <http://purl.obolibrary.org/obo/>

        SELECT DISTINCT ?connection ?connectedAt ?person ?personName ?currentOrganization ?organizationName
        WHERE {
          # Match the organization entity directly (filter first for efficiency)
          VALUES ?orgURI { <{{ organization_uri }}> }

          # Get only those CurrentOrganization instances that reference the organization URI
          ?currentOrganization a linkedin:CurrentOrganization ;
                               bfo:BFO_0000197 ?orgURI ;
                               rdfs:label ?organizationName .

          # Get people who currently have this organization as their current organization
          ?person a cco:ont00001262 ;
                  rdfs:label ?personName ;
                  linkedin:hasCurrentOrganization ?currentOrganization .

          # Get connection events involving this person
          ?connection a linkedin:ActOfConnection ;
                      linkedin:involvesAgent ?person ;
                      linkedin:connectedAt ?connectedAt .
        }
        ORDER BY DESC(?connectedAt)
        LIMIT {{ limit|default(50) }}
        OFFSET {{ offset|default(0) }}
    """ ;
    intentMapping:hasArgument intentMapping:organizationUriArg , intentMapping:limitArg , intentMapping:offsetArg .

# Search for all LinkedIn person info (all qualities) by their URI
intentMapping:LinkedInSearchPersonInfoByPersonUri a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_person_info"@en ;
    intentMapping:intentDescription """Given a person's URI, retrieve all available LinkedIn profile information qualities, including:
      - Current Job Position
      - Current Organization
      - Current Public URL
      - Email Address
      Each quality is returned as a value (label), not as the URI of the quality entity.
    """ ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT DISTINCT
          ?personName
          ?currentJobPositionValue
          ?currentOrganizationValue
          ?currentPublicUrlValue
          ?emailAddressValue
        WHERE {
          BIND(<{{ person_uri }}> AS ?person)
          ?person a cco:ont00001262 ;
                  rdfs:label ?personName .

          OPTIONAL {
            ?person linkedin:hasCurrentJobPosition ?currentJobPosition .
            ?currentJobPosition a linkedin:CurrentJobPosition ;
                               rdfs:label ?currentJobPositionValue .
          }
          OPTIONAL {
            ?person linkedin:hasCurrentOrganization ?currentOrganization .
            ?currentOrganization a linkedin:CurrentOrganization ;
                                rdfs:label ?currentOrganizationValue .
          }
          OPTIONAL {
            ?person linkedin:hasCurrentPublicUrl ?currentPublicUrl .
            ?currentPublicUrl a linkedin:CurrentPublicUrl ;
                              rdfs:label ?currentPublicUrlValue .
          }
          OPTIONAL {
            ?person linkedin:hasEmailAddress ?emailAddress .
            ?emailAddress a linkedin:EmailAddress ;
                          rdfs:label ?emailAddressValue .
          }
        }
    """ ;
    intentMapping:hasArgument intentMapping:personUriArg .

# Search persons by job title and organization
intentMapping:LinkedInSearchPersonsByJobTitleAndOrganization a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_person_by_job_title_and_organization"@en ;
    intentMapping:intentDescription """Search for a persons by LinkedIn job title and organization. You can optionally provide an organization name to filter the results. Returns person, person name, job position name, organization name, and public URL.""" ;
    intentMapping:sparqlTemplate """
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
    PREFIX cco: <https://www.commoncoreontologies.org/>

    SELECT DISTINCT ?person ?personName ?jobPositionName ?organizationName ?publicUrl
    WHERE {
      ?currentJobPosition a linkedin:CurrentJobPosition ;
                          rdfs:label ?jobPositionName .

      FILTER(CONTAINS(LCASE(?jobPositionName), LCASE("{{ job_title }}")))

      OPTIONAL {
        ?currentOrganization a linkedin:CurrentOrganization ;
                            rdfs:label ?organizationName .
        FILTER(CONTAINS(LCASE(?organizationName), LCASE("{{ organization_name }}")))
      }

      ?person a cco:ont00001262 ;
              rdfs:label ?personName ;
              linkedin:hasCurrentJobPosition ?currentJobPosition ;
              linkedin:hasCurrentOrganization ?currentOrganization ;
              linkedin:isOwnerOf ?LinkedInProfilePage .

      ?currentOrganization a linkedin:CurrentOrganization ;
                           rdfs:label ?organizationName .

      ?LinkedInProfilePage a linkedin:ProfilePage ;
                           rdfs:label ?publicUrl .
    }
    ORDER BY ASC(?personName)
    LIMIT {{ limit|default(50) }}
    OFFSET {{ offset|default(0) }}
    """ ;
    intentMapping:hasArgument intentMapping:jobTitleArg , intentMapping:organizationNameArg , intentMapping:limitArg , intentMapping:offsetArg .

########################################################
# LinkedIn Act of Connections Arguments
########################################################

intentMapping:personUriArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "person_uri" ;
    intentMapping:argumentDescription "URI of the person" ;
    intentMapping:validationPattern "^http://ontology\\.naas\\.ai/.+/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" ;
    intentMapping:validationFormat "person_uri" .

intentMapping:personUri1Arg a intentMapping:QueryArgument ;
    intentMapping:argumentName "person_uri_1" ;
    intentMapping:argumentDescription "URI of the first person" ;
    intentMapping:validationPattern "^http://ontology\\.naas\\.ai/.+/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" ;
    intentMapping:validationFormat "person_uri_1" .

intentMapping:personUri2Arg a intentMapping:QueryArgument ;
    intentMapping:argumentName "person_uri_2" ;
    intentMapping:argumentDescription "URI of the second person" ;
    intentMapping:validationPattern "^http://ontology\\.naas\\.ai/.+/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" ;
    intentMapping:validationFormat "person_uri_2" .

intentMapping:organizationUriArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "organization_uri" ;
    intentMapping:argumentDescription "URI of the organization" ;
    intentMapping:validationPattern "^http://ontology\\.naas\\.ai/.+/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" ;
    intentMapping:validationFormat "organization_uri" .

intentMapping:jobTitleArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "job_title" ;
    intentMapping:argumentDescription "Job title to search for" ;
    intentMapping:validationPattern "^.+$" ;
    intentMapping:validationFormat "job_title" .

intentMapping:organizationNameArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "organization_name" ;
    intentMapping:argumentDescription "Organization name to search for" ;
    intentMapping:validationPattern "^.+$" ;
    intentMapping:validationFormat "organization_name" .

intentMapping:limitArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "limit" ;
    intentMapping:argumentDescription "Maximum number of results to return (default: 50)" ;
    intentMapping:validationPattern "^[0-9]+$" ;
    intentMapping:validationFormat "limit" ;
    intentMapping:isOptional true .

intentMapping:offsetArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "offset" ;
    intentMapping:argumentDescription "Number of results to skip for pagination (default: 0)" ;
    intentMapping:validationPattern "^[0-9]+$" ;
    intentMapping:validationFormat "offset" ;
    intentMapping:isOptional true .