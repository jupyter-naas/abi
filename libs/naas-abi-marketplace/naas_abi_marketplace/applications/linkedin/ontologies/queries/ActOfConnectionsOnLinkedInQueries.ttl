@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dc11: <http://purl.org/dc/elements/1.1/> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix cco: <https://www.commoncoreontologies.org/> .
@prefix abi: <http://ontology.naas.ai/abi/> .
@prefix linkedin: <http://ontology.naas.ai/abi/linkedin/> .
@prefix intentMapping: <http://ontology.naas.ai/intentMapping/> .

########################################################
# LinkedIn Act of Connections Queries
########################################################

# Search connections by person name
intentMapping:LinkedInSearchConnectionsByPersonName a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_connections_by_person_name"@en ;
    intentMapping:intentDescription "Search for LinkedIn connections by person name. Returns connection URIs, connected date, and information about both persons involved in each connection." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>
        PREFIX bfo: <http://purl.obolibrary.org/obo/>

        SELECT DISTINCT ?connection ?connectedAt ?person1 ?person1Name ?person2 ?person2Name
        WHERE {
          ?connection a linkedin:ActOfConnection ;
                      linkedin:connectedAt ?connectedAt ;
                      linkedin:involvesAgent ?person1 , ?person2 .
          
          ?person1 a cco:ont00001262 ; # Person
                   rdfs:label ?person1Name .
          ?person2 a cco:ont00001262 ; # Person
                   rdfs:label ?person2Name .
          
          FILTER(?person1 != ?person2)
          FILTER(CONTAINS(LCASE(STR(?person1Name)), LCASE("{{ person_name }}")) || 
                 CONTAINS(LCASE(STR(?person2Name)), LCASE("{{ person_name }}")))
        }
        ORDER BY ?connectedAt DESC
        LIMIT 100
    """ ;
    intentMapping:hasArgument intentMapping:personNameArg .

# Count all connections for a specific person
intentMapping:LinkedInCountConnectionsByPersonUri a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_count_connections_by_person"@en ;
    intentMapping:intentDescription "Count the total number of LinkedIn connections for a specific person by their URI." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>
        PREFIX bfo: <http://purl.obolibrary.org/obo/>

        SELECT (COUNT(DISTINCT ?connectedPerson) AS ?connectionCount)
        WHERE {
          <{{ person_uri }}> a cco:ont00001262 ;
                             linkedin:agentInvolvedIn ?connection .

          ?connection a linkedin:ActOfConnection ;
                      linkedin:involvesAgent ?connectedPerson .

          ?connectedPerson a cco:ont00001262 .

          FILTER(?connectedPerson != <{{ person_uri }}>)
        }
    """ ;
    intentMapping:hasArgument intentMapping:personUriArg .

# Get connection details by connection URI
intentMapping:LinkedInGetConnectionByUri a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_get_connection_information"@en ;
    intentMapping:intentDescription "Get detailed information about a specific connection by its URI. Returns all persons involved, connection date, location, associated qualities, and connection roles." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>
        PREFIX bfo: <http://purl.obolibrary.org/obo/>

        SELECT DISTINCT ?connection ?connectedAt ?location ?locationName 
                        (GROUP_CONCAT(DISTINCT STR(?person);separator=",") AS ?personUris)
                        (GROUP_CONCAT(DISTINCT ?personName;separator=",") AS ?personNames)
                        (GROUP_CONCAT(DISTINCT STR(?quality);separator=",") AS ?qualityUris)
                        (GROUP_CONCAT(DISTINCT STR(?connectionRole);separator=",") AS ?connectionRoleUris)
        WHERE {
          <{{ connection_uri }}> a linkedin:ActOfConnection ;
                                 linkedin:connectedAt ?connectedAt ;
                                 linkedin:involvesAgent ?person ;
                                 bfo:BFO_0000066 ?location .
          
          ?person a cco:ont00001262 ; # Person
                 rdfs:label ?personName .
          ?location rdfs:label ?locationName .
          
          OPTIONAL {
            <{{ connection_uri }}> linkedin:hasAssociatedQuality ?quality .
          }
          
          OPTIONAL {
            ?connectionRole bfo:BFO_0000054 <{{ connection_uri }}> .
          }
        }
        GROUP BY ?connection ?connectedAt ?location ?locationName
    """ ;
    intentMapping:hasArgument intentMapping:connectionUriArg .

# Search connections by date
intentMapping:LinkedInSearchConnectionsByDate a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_connections_by_date"@en ;
    intentMapping:intentDescription "Search for LinkedIn connections by specific date. Returns connection URIs and information about persons involved." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT DISTINCT ?connection ?connectedAt 
                        (GROUP_CONCAT(DISTINCT STR(?person);separator=",") AS ?personUris)
                        (GROUP_CONCAT(DISTINCT ?personName;separator=",") AS ?personNames)
        WHERE {
          ?connection a linkedin:ActOfConnection ;
                      linkedin:connectedAt ?connectedAt ;
                      linkedin:involvesAgent ?person .
          
          ?person a cco:ont00001262 ; # Person
                 rdfs:label ?personName .
          
          FILTER(STR(?connectedAt) = "{{ connection_date }}")
        }
        GROUP BY ?connection ?connectedAt
        ORDER BY ?connectedAt DESC
    """ ;
    intentMapping:hasArgument intentMapping:connectionDateArg .

# Get connections within a date range
intentMapping:LinkedInGetConnectionsByDateRange a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_get_connections_by_date_range"@en ;
    intentMapping:intentDescription "Get all LinkedIn connections within a specific date range. Returns connection URIs, connected date, and person information." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

        SELECT DISTINCT ?connection ?connectedAt 
                        (GROUP_CONCAT(DISTINCT STR(?person);separator=",") AS ?personUris)
                        (GROUP_CONCAT(DISTINCT ?personName;separator=",") AS ?personNames)
        WHERE {
          ?connection a linkedin:ActOfConnection ;
                      linkedin:connectedAt ?connectedAt ;
                      linkedin:involvesAgent ?person .
          
          ?person a cco:ont00001262 ; # Person
                 rdfs:label ?personName .
          
          FILTER(STR(?connectedAt) >= "{{ start_date }}" && STR(?connectedAt) <= "{{ end_date }}")
        }
        GROUP BY ?connection ?connectedAt
        ORDER BY ?connectedAt DESC
    """ ;
    intentMapping:hasArgument intentMapping:startDateArg ;
    intentMapping:hasArgument intentMapping:endDateArg .

# Search connections by organization
intentMapping:LinkedInSearchConnectionsByOrganization a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_connections_by_organization"@en ;
    intentMapping:intentDescription "Search for LinkedIn connections where at least one person works at a specific organization. Returns connection URIs, connected date, and person information." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT DISTINCT ?connection ?connectedAt ?person ?personName ?currentOrganization ?organizationName
        WHERE {
          ?connection a linkedin:ActOfConnection ;
                      linkedin:connectedAt ?connectedAt ;
                      linkedin:involvesAgent ?person .
          
          ?person a cco:ont00001262 ; # Person
                 rdfs:label ?personName ;
                 linkedin:hasCurrentOrganization ?currentOrganization .
          
          ?currentOrganization rdfs:label ?organizationName .
          
          FILTER(CONTAINS(LCASE(STR(?organizationName)), LCASE("{{ organization_name }}")))
        }
        ORDER BY ?connectedAt DESC
    """ ;
    intentMapping:hasArgument intentMapping:organizationNameArg .

# Search connections by job position
intentMapping:LinkedInSearchConnectionsByJobPosition a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_connections_by_job_position"@en ;
    intentMapping:intentDescription "Search for LinkedIn connections where at least one person has a specific job position. Returns connection URIs, connected date, and person information." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT DISTINCT ?connection ?connectedAt ?person ?personName ?currentJobPosition ?jobPositionName
        WHERE {
          ?connection a linkedin:ActOfConnection ;
                      linkedin:connectedAt ?connectedAt ;
                      linkedin:involvesAgent ?person .
          
          ?person a cco:ont00001262 ; # Person
                 rdfs:label ?personName ;
                 linkedin:hasCurrentJobPosition ?currentJobPosition .
          
          ?currentJobPosition rdfs:label ?jobPositionName .
          
          FILTER(CONTAINS(LCASE(STR(?jobPositionName)), LCASE("{{ job_position_name }}")))
        }
        ORDER BY ?connectedAt DESC
    """ ;
    intentMapping:hasArgument intentMapping:jobPositionNameArg .

# Confirm you want to search for a person's email address on LinkedIn by their URI
intentMapping:LinkedInSearchEmailAddressByPersonUri a intentMapping:TemplatableSparqlQuery ;
    rdfs:label "linkedin_search_email_address_by_person_uri"@en ;
    intentMapping:intentDescription "Given a person's URI, retrieve their email address." ;
    intentMapping:sparqlTemplate """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX linkedin: <http://ontology.naas.ai/abi/linkedin/>
        PREFIX cco: <https://www.commoncoreontologies.org/>

        SELECT DISTINCT ?person ?personName ?emailAddress ?emailAddressValue
        WHERE {
          BIND(<{{ person_uri }}> AS ?person)
          ?person a cco:ont00001262 ;
                 rdfs:label ?personName ;
                 linkedin:hasEmailAddress ?emailAddress .
          ?emailAddress rdfs:label ?emailAddressValue .
        }
    """ ;
    intentMapping:hasArgument intentMapping:personUriArg .
    
########################################################
# LinkedIn Act of Connections Arguments
########################################################

intentMapping:personNameArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "person_name" ;
    intentMapping:argumentDescription "Name of the person to search for" ;
    intentMapping:validationPattern "." ;
    intentMapping:validationFormat "person_name" .

intentMapping:personUriArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "person_uri" ;
    intentMapping:argumentDescription "URI of the person" ;
    intentMapping:validationPattern "^http://ontology\\.naas\\.ai/.+/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" ;
    intentMapping:validationFormat "person_uri" .

intentMapping:connectionUriArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "connection_uri" ;
    intentMapping:argumentDescription "URI of the connection" ;
    intentMapping:validationPattern "^http://ontology\\.naas\\.ai/.+/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" ;
    intentMapping:validationFormat "connection_uri" .

intentMapping:connectionDateArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "connection_date" ;
    intentMapping:argumentDescription "Date of the connection in ISO 8601 UTC format (e.g., 2025-10-23T00:00:00.000Z)" ;
    intentMapping:validationPattern "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\\.[0-9]{3}Z$" ;
    intentMapping:validationFormat "connection_date" .

intentMapping:organizationNameArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "organization_name" ;
    intentMapping:argumentDescription "Name of the organization to search for" ;
    intentMapping:validationPattern "." ;
    intentMapping:validationFormat "organization_name" .

intentMapping:locationNameArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "location_name" ;
    intentMapping:argumentDescription "Name of the location to search for" ;
    intentMapping:validationPattern "." ;
    intentMapping:validationFormat "location_name" .

intentMapping:jobPositionNameArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "job_position_name" ;
    intentMapping:argumentDescription "Name of the job position to search for" ;
    intentMapping:validationPattern "." ;
    intentMapping:validationFormat "job_position_name" .

intentMapping:emailAddressArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "email_address" ;
    intentMapping:argumentDescription "Email address to search for" ;
    intentMapping:validationPattern "." ;
    intentMapping:validationFormat "email_address" .

intentMapping:startDateArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "start_date" ;
    intentMapping:argumentDescription "Start date of the date range in ISO 8601 UTC format (e.g., 2025-01-01T00:00:00.000Z)" ;
    intentMapping:validationPattern "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\\.[0-9]{3}Z$" ;
    intentMapping:validationFormat "start_date" .

intentMapping:endDateArg a intentMapping:QueryArgument ;
    intentMapping:argumentName "end_date" ;
    intentMapping:argumentDescription "End date of the date range in ISO 8601 UTC format (e.g., 2025-12-31T23:59:59.999Z)" ;
    intentMapping:validationPattern "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\\.[0-9]{3}Z$" ;
    intentMapping:validationFormat "end_date" .