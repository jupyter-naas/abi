@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix nexus: <http://nexus.platform/ontology/> .


# ======================================================================
# Secret Resolution Process
# BFO 7 Buckets Compliant (ISO 21383-2)
# ======================================================================

nexus:secret_resolution_process a owl:Ontology ;
    dc:title "Secret Resolution Process"@en ;
    dc:description "A process that decrypts a secret value by workspace_id and key for internal use (provider API key resolution), using Fernet symmetric decryption. Never exposed to API clients."@en ;
    dc:created "2026-02-09"^^xsd:date ;
    owl:imports <http://ontology.naas.ai/abi/BFO7Buckets> ,
                <http://nexus.platform/ontology/_shared/common_entities> .


# ======================================================================
# WHAT: Process (BFO_0000015)
# ======================================================================

nexus:SecretResolutionProcess a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000015 ;
    rdfs:label "Secret Resolution Process"@en ;
    skos:definition "A process that decrypts a secret value by workspace_id and key for internal use (provider API key resolution), using Fernet symmetric decryption. Never exposed to API clients."@en ;
    rdfs:comment "Implements: apps/api/app/api/endpoints/secrets.py:332-343 resolve_secret_async()" ;
    skos:example "1. Query secrets table: WHERE workspace_id=? AND key=?\n2. If not found: return None\n3. Decrypt: Fernet(derived_key).decrypt(encrypted_value)\n4. Return plaintext value\n5. On error: log warning, return None"@en .

# ======================================================================
# WHO: Material Entities (BFO_0000040)
# ======================================================================

nexus:ProviderResolver a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "ProviderResolver"@en ;
    skos:definition "Internal service needing decrypted API key"@en .

nexus:FernetDecryptor a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "FernetDecryptor"@en ;
    skos:definition "Fernet decryption engine"@en .

# ======================================================================
# WHERE: Sites (BFO_0000029)
# ======================================================================

nexus:SecretsTable a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "SecretsTable"@en ;
    skos:definition "PostgreSQL secrets table queried by workspace_id + key"@en .

# ======================================================================
# WHEN: Temporal Regions (BFO_0000008)
# ======================================================================

nexus:ResolutionDuration a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000008 ;
    rdfs:label "ResolutionDuration"@en ;
    skos:definition "15-25ms: query + decryption"@en .

# ======================================================================
# HOW WE KNOW: Information Entities (BFO_0000031)
# ======================================================================

nexus:DecryptedValue a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "DecryptedValue"@en ;
    skos:definition "Plaintext API key after Fernet decryption"@en .

nexus:SecretKeyLookup a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "SecretKeyLookup"@en ;
    skos:definition "Query: SELECT * FROM secrets WHERE workspace_id=? AND key=?"@en .

# ======================================================================
# HOW IT IS: Qualities (BFO_0000019)
# ======================================================================

nexus:InternalOnly a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "InternalOnly"@en ;
    skos:definition "Quality: this function is never exposed as an API endpoint"@en .

nexus:NullSafety a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "NullSafety"@en ;
    skos:definition "Quality: returns None if secret not found or decryption fails"@en .

# ======================================================================
# WHY: Roles (BFO_0000023)
# ======================================================================

nexus:SecretDecryptorRole a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000023 ;
    rdfs:label "SecretDecryptorRole"@en ;
    skos:definition "Role realized when system decrypts secrets for internal provider authentication"@en .

# ======================================================================
# WHY: Dispositions (BFO_0000016)
# ======================================================================

nexus:GracefulFailureDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "GracefulFailureDisposition"@en ;
    skos:definition "Disposition to return None on decryption error instead of raising"@en .

# ======================================================================
# Process Relationships (BFO Object Properties)
# ======================================================================

nexus:secret_resolution_process_has_providerresolver a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000057 ;
    rdfs:domain nexus:SecretResolutionProcess ;
    rdfs:range nexus:ProviderResolver ;
    rdfs:label "SecretResolutionProcess has participant ProviderResolver"@en .

nexus:secret_resolution_process_occurs_in a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000066 ;
    rdfs:domain nexus:SecretResolutionProcess ;
    rdfs:range nexus:SecretsTable ;
    rdfs:label "SecretResolutionProcess occurs in SecretsTable"@en .

nexus:secret_resolution_process_occupies a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000199 ;
    rdfs:domain nexus:SecretResolutionProcess ;
    rdfs:range nexus:ResolutionDuration ;
    rdfs:label "SecretResolutionProcess occupies ResolutionDuration"@en .

nexus:secret_resolution_process_realizes a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000055 ;
    rdfs:domain nexus:SecretResolutionProcess ;
    rdfs:range nexus:SecretDecryptorRole ;
    rdfs:label "SecretResolutionProcess realizes SecretDecryptorRole"@en .

# ======================================================================
# Data Properties
# ======================================================================

nexus:lookupKey a owl:DatatypeProperty ;
    rdfs:label "lookupKey"@en ;
    rdfs:range xsd:string .

nexus:foundSecret a owl:DatatypeProperty ;
    rdfs:label "foundSecret"@en ;
    rdfs:range xsd:boolean .
