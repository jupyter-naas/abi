@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix nexus: <http://nexus.platform/ontology/> .


# ======================================================================
# Bulk Secret Import Process
# BFO 7 Buckets Compliant (ISO 21383-2)
# ======================================================================

nexus:bulk_secret_import_process a owl:Ontology ;
    dc:title "Bulk Secret Import Process"@en ;
    dc:description "A process that imports multiple secrets from .env file format (KEY=VALUE lines), parsing, encrypting, and upserting each key-value pair into the secrets table."@en ;
    dc:created "2026-02-09"^^xsd:date ;
    owl:imports <http://ontology.naas.ai/abi/BFO7Buckets> ,
                <http://nexus.platform/ontology/_shared/common_entities> .


# ======================================================================
# WHAT: Process (BFO_0000015)
# ======================================================================

nexus:BulkSecretImportProcess a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000015 ;
    rdfs:label "Bulk Secret Import Process"@en ;
    skos:definition "A process that imports multiple secrets from .env file format (KEY=VALUE lines), parsing, encrypting, and upserting each key-value pair into the secrets table."@en ;
    rdfs:comment "Implements: apps/api/app/api/endpoints/secrets.py:226-283 bulk_import_secrets()" ;
    skos:example "1. Validate workspace access (admin/owner)\n2. Parse .env content line by line\n3. Skip empty lines and comments (#)\n4. Split each line by = to get key and value\n5. Strip quotes from value\n6. Encrypt value with Fernet\n7. Check if secret exists (by workspace_id + key)\n8. If exists: update encrypted_value and updated_at\n9. If new: insert new secret row\n10. Track imported and updated counts\n11. Commit transaction and return counts"@en .

# ======================================================================
# WHO: Material Entities (BFO_0000040)
# ======================================================================

nexus:EnvFileParser a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "EnvFileParser"@en ;
    skos:definition "Parser extracting KEY=VALUE pairs from .env content"@en .

nexus:BulkEncryptor a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "BulkEncryptor"@en ;
    skos:definition "Fernet encryption applied to each value"@en .

# ======================================================================
# WHERE: Sites (BFO_0000029)
# ======================================================================

nexus:ImportEndpoint a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "ImportEndpoint"@en ;
    skos:definition "API endpoint POST /api/secrets/import"@en .

# ======================================================================
# WHEN: Temporal Regions (BFO_0000008)
# ======================================================================

nexus:ImportDuration a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000008 ;
    rdfs:label "ImportDuration"@en ;
    skos:definition "100ms + 30ms per secret for parsing + encryption + upsert"@en .

# ======================================================================
# HOW WE KNOW: Information Entities (BFO_0000031)
# ======================================================================

nexus:SecretBulkImport a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "SecretBulkImport"@en ;
    skos:definition "Pydantic model: workspace_id, env_content (1-500000 chars)"@en .

nexus:ImportResult a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "ImportResult"@en ;
    skos:definition "Dict: imported (new count), updated (existing count)"@en .

nexus:EnvFormat a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "EnvFormat"@en ;
    skos:definition "Format: KEY=VALUE or KEY='VALUE' or KEY=\"VALUE\" per line, # for comments"@en .

# ======================================================================
# HOW IT IS: Qualities (BFO_0000019)
# ======================================================================

nexus:QuoteHandling a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "QuoteHandling"@en ;
    skos:definition "Quality: strips single and double quotes from values"@en .

nexus:CommentSkipping a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "CommentSkipping"@en ;
    skos:definition "Quality: skips empty lines and lines starting with #"@en .

# ======================================================================
# WHY: Roles (BFO_0000023)
# ======================================================================

nexus:BulkImporterRole a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000023 ;
    rdfs:label "BulkImporterRole"@en ;
    skos:definition "Role realized when system imports multiple secrets at once"@en .

# ======================================================================
# WHY: Dispositions (BFO_0000016)
# ======================================================================

nexus:UpsertDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "UpsertDisposition"@en ;
    skos:definition "Disposition to update existing secrets or create new ones"@en .

# ======================================================================
# Process Relationships (BFO Object Properties)
# ======================================================================

nexus:bulk_secret_import_process_has_envfileparser a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000057 ;
    rdfs:domain nexus:BulkSecretImportProcess ;
    rdfs:range nexus:EnvFileParser ;
    rdfs:label "BulkSecretImportProcess has participant EnvFileParser"@en .

nexus:bulk_secret_import_process_occurs_in a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000066 ;
    rdfs:domain nexus:BulkSecretImportProcess ;
    rdfs:range nexus:ImportEndpoint ;
    rdfs:label "BulkSecretImportProcess occurs in ImportEndpoint"@en .

nexus:bulk_secret_import_process_occupies a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000199 ;
    rdfs:domain nexus:BulkSecretImportProcess ;
    rdfs:range nexus:ImportDuration ;
    rdfs:label "BulkSecretImportProcess occupies ImportDuration"@en .

nexus:bulk_secret_import_process_realizes a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000055 ;
    rdfs:domain nexus:BulkSecretImportProcess ;
    rdfs:range nexus:BulkImporterRole ;
    rdfs:label "BulkSecretImportProcess realizes BulkImporterRole"@en .

# ======================================================================
# Data Properties
# ======================================================================

nexus:importedCount a owl:DatatypeProperty ;
    rdfs:label "importedCount"@en ;
    rdfs:range xsd:integer .

nexus:updatedCount a owl:DatatypeProperty ;
    rdfs:label "updatedCount"@en ;
    rdfs:range xsd:integer .

nexus:totalLines a owl:DatatypeProperty ;
    rdfs:label "totalLines"@en ;
    rdfs:range xsd:integer .
