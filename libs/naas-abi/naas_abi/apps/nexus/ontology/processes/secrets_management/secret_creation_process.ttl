@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix nexus: <http://nexus.platform/ontology/> .


# ======================================================================
# Secret Creation Process
# BFO 7 Buckets Compliant (ISO 21383-2)
# ======================================================================

nexus:secret_creation_process a owl:Ontology ;
    dc:title "Secret Creation Process"@en ;
    dc:description "A process that creates an encrypted secret (API key, credential, token) in a workspace using Fernet symmetric encryption (AES-128-CBC + HMAC-SHA256), returning a masked value to the client."@en ;
    dc:created "2026-02-09"^^xsd:date ;
    owl:imports <http://ontology.naas.ai/abi/BFO7Buckets> ,
                <http://nexus.platform/ontology/_shared/common_entities> .


# ======================================================================
# WHAT: Process (BFO_0000015)
# ======================================================================

nexus:SecretCreationProcess a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000015 ;
    rdfs:label "Secret Creation Process"@en ;
    skos:definition "A process that creates an encrypted secret (API key, credential, token) in a workspace using Fernet symmetric encryption (AES-128-CBC + HMAC-SHA256), returning a masked value to the client."@en ;
    rdfs:comment "Implements: apps/api/app/api/endpoints/secrets.py:139-174 create_secret()" ;
    skos:example "1. Validate workspace access (admin/owner required)\n2. Check uniqueness: SELECT FROM secrets WHERE workspace_id=? AND key=?\n3. Infer category if not provided (API_KEY->api_keys, TOKEN->tokens, PASSWORD->credentials)\n4. Encrypt value: Fernet(base64(sha256(settings.secret_key))).encrypt(value)\n5. Generate secret ID (uuid4)\n6. Insert into secrets table: id, workspace_id, key, encrypted_value, description, category\n7. Mask value for response: value[:4] + **** + value[-4:]\n8. Return SecretResponse"@en .

# ======================================================================
# WHO: Material Entities (BFO_0000040)
# ======================================================================

nexus:SecretCreator a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "SecretCreator"@en ;
    skos:definition "Admin/owner user storing a secret"@en .

nexus:FernetEncryptor a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "FernetEncryptor"@en ;
    skos:definition "Fernet encryption engine derived from settings.secret_key"@en .

# ======================================================================
# WHERE: Sites (BFO_0000029)
# ======================================================================

nexus:SecretsEndpoint a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "SecretsEndpoint"@en ;
    skos:definition "API endpoint POST /api/secrets"@en .

nexus:SecretsTable a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "SecretsTable"@en ;
    skos:definition "PostgreSQL secrets table with encrypted_value column"@en .

# ======================================================================
# WHEN: Temporal Regions (BFO_0000008)
# ======================================================================

nexus:EncryptionDuration a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000008 ;
    rdfs:label "EncryptionDuration"@en ;
    skos:definition "30-60ms: uniqueness check + encryption + insert"@en .

# ======================================================================
# HOW WE KNOW: Information Entities (BFO_0000031)
# ======================================================================

nexus:SecretCreate a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "SecretCreate"@en ;
    skos:definition "Pydantic model: workspace_id, key (pattern ^[\\w-. ]+$), value (1-50000 chars), description, category"@en .

nexus:EncryptedValue a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "EncryptedValue"@en ;
    skos:definition "Fernet-encrypted string stored in encrypted_value column"@en .

nexus:MaskedValue a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "MaskedValue"@en ;
    skos:definition "First 4 + **** + last 4 chars of value (or **** if <= 8 chars)"@en .

nexus:SecretResponse a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "SecretResponse"@en ;
    skos:definition "Response: id, key, masked_value, description, category, timestamps"@en .

# ======================================================================
# HOW IT IS: Qualities (BFO_0000019)
# ======================================================================

nexus:EncryptionStrength a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "EncryptionStrength"@en ;
    skos:definition "Quality: Fernet AES-128-CBC + HMAC-SHA256 encryption"@en .

nexus:CategoryInference a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "CategoryInference"@en ;
    skos:definition "Quality: auto-infer category from key name (API_KEY->api_keys, TOKEN->tokens)"@en .

# ======================================================================
# WHY: Roles (BFO_0000023)
# ======================================================================

nexus:SecretKeeperRole a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000023 ;
    rdfs:label "SecretKeeperRole"@en ;
    skos:definition "Role realized when system encrypts and stores sensitive values"@en .

# ======================================================================
# WHY: Dispositions (BFO_0000016)
# ======================================================================

nexus:FernetEncryptionDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "FernetEncryptionDisposition"@en ;
    skos:definition "Disposition to encrypt values using Fernet derived from SHA-256 of secret_key"@en .

nexus:CategoryInferenceDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "CategoryInferenceDisposition"@en ;
    skos:definition "Disposition to auto-categorize based on key name patterns"@en .

# ======================================================================
# Process Relationships (BFO Object Properties)
# ======================================================================

nexus:secret_creation_process_has_secretcreator a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000057 ;
    rdfs:domain nexus:SecretCreationProcess ;
    rdfs:range nexus:SecretCreator ;
    rdfs:label "SecretCreationProcess has participant SecretCreator"@en .

nexus:secret_creation_process_occurs_in a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000066 ;
    rdfs:domain nexus:SecretCreationProcess ;
    rdfs:range nexus:SecretsEndpoint ;
    rdfs:label "SecretCreationProcess occurs in SecretsEndpoint"@en .

nexus:secret_creation_process_occupies a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000199 ;
    rdfs:domain nexus:SecretCreationProcess ;
    rdfs:range nexus:EncryptionDuration ;
    rdfs:label "SecretCreationProcess occupies EncryptionDuration"@en .

nexus:secret_creation_process_realizes a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000055 ;
    rdfs:domain nexus:SecretCreationProcess ;
    rdfs:range nexus:SecretKeeperRole ;
    rdfs:label "SecretCreationProcess realizes SecretKeeperRole"@en .

# ======================================================================
# Data Properties
# ======================================================================

nexus:secretKey a owl:DatatypeProperty ;
    rdfs:label "secretKey"@en ;
    rdfs:range xsd:string .

nexus:secretCategory a owl:DatatypeProperty ;
    rdfs:label "secretCategory"@en ;
    rdfs:range xsd:string .

nexus:isEncrypted a owl:DatatypeProperty ;
    rdfs:label "isEncrypted"@en ;
    rdfs:range xsd:boolean .
