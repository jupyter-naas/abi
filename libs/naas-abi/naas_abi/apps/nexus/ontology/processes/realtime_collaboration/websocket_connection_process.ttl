@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix nexus: <http://nexus.platform/ontology/> .


# ======================================================================
# WebSocket Connection Process
# BFO 7 Buckets Compliant (ISO 21383-2)
# ======================================================================

nexus:websocket_connection_process a owl:Ontology ;
    dc:title "WebSocket Connection Process"@en ;
    dc:description "A process that establishes a Socket.IO WebSocket connection, authenticating the user and initializing session data with user_id and empty workspace set."@en ;
    dc:created "2026-02-09"^^xsd:date ;
    owl:imports <http://ontology.naas.ai/abi/BFO7Buckets> ,
                <http://nexus.platform/ontology/_shared/common_entities> .


# ======================================================================
# WHAT: Process (BFO_0000015)
# ======================================================================

nexus:WebSocketConnectionProcess a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000015 ;
    rdfs:label "WebSocket Connection Process"@en ;
    skos:definition "A process that establishes a Socket.IO WebSocket connection, authenticating the user and initializing session data with user_id and empty workspace set."@en ;
    rdfs:comment "Implements: apps/api/app/services/websocket.py:34-58 connect handler" ;
    skos:example "1. Extract user_id from auth dict (or query string fallback)\n2. Store session data: session[user_id] = user_id\n3. Initialize empty workspaces set in session\n4. Return True to allow connection"@en .

# ======================================================================
# WHO: Material Entities (BFO_0000040)
# ======================================================================

nexus:WebSocketClient a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "WebSocketClient"@en ;
    skos:definition "Browser Socket.IO client connecting from frontend"@en .

nexus:SocketIOServer a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "SocketIOServer"@en ;
    skos:definition "Python-socketio AsyncServer handling connections"@en .

# ======================================================================
# WHERE: Sites (BFO_0000029)
# ======================================================================

nexus:WebSocketEndpoint a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "WebSocketEndpoint"@en ;
    skos:definition "Socket.IO endpoint at /socket.io/ path"@en .

# ======================================================================
# WHEN: Temporal Regions (BFO_0000008)
# ======================================================================

nexus:ConnectionDuration a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000008 ;
    rdfs:label "ConnectionDuration"@en ;
    skos:definition "Less than 1ms for session initialization"@en .

# ======================================================================
# HOW WE KNOW: Information Entities (BFO_0000031)
# ======================================================================

nexus:SessionData a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "SessionData"@en ;
    skos:definition "Dict: user_id (str), workspaces (empty set)"@en .

nexus:AuthPayload a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "AuthPayload"@en ;
    skos:definition "Dict from client: {user_id: string}"@en .

nexus:SessionId a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "SessionId"@en ;
    skos:definition "Socket.IO sid (unique per connection)"@en .

# ======================================================================
# HOW IT IS: Qualities (BFO_0000019)
# ======================================================================

nexus:AuthenticationLevel a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "AuthenticationLevel"@en ;
    skos:definition "Quality: currently allows all connections (debugging mode)"@en .

nexus:SessionIsolation a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "SessionIsolation"@en ;
    skos:definition "Quality: each connection has independent session data"@en .

# ======================================================================
# WHY: Roles (BFO_0000023)
# ======================================================================

nexus:ConnectionManagerRole a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000023 ;
    rdfs:label "ConnectionManagerRole"@en ;
    skos:definition "Role realized when server accepts WebSocket connections"@en .

# ======================================================================
# WHY: Dispositions (BFO_0000016)
# ======================================================================

nexus:DebugModeDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "DebugModeDisposition"@en ;
    skos:definition "Disposition to allow all connections without JWT validation (temporary)"@en .

# ======================================================================
# Process Relationships (BFO Object Properties)
# ======================================================================

nexus:websocket_connection_process_has_websocketclient a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000057 ;
    rdfs:domain nexus:WebSocketConnectionProcess ;
    rdfs:range nexus:WebSocketClient ;
    rdfs:label "WebSocketConnectionProcess has participant WebSocketClient"@en .

nexus:websocket_connection_process_occurs_in a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000066 ;
    rdfs:domain nexus:WebSocketConnectionProcess ;
    rdfs:range nexus:WebSocketEndpoint ;
    rdfs:label "WebSocketConnectionProcess occurs in WebSocketEndpoint"@en .

nexus:websocket_connection_process_occupies a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000199 ;
    rdfs:domain nexus:WebSocketConnectionProcess ;
    rdfs:range nexus:ConnectionDuration ;
    rdfs:label "WebSocketConnectionProcess occupies ConnectionDuration"@en .

nexus:websocket_connection_process_realizes a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000055 ;
    rdfs:domain nexus:WebSocketConnectionProcess ;
    rdfs:range nexus:ConnectionManagerRole ;
    rdfs:label "WebSocketConnectionProcess realizes ConnectionManagerRole"@en .

# ======================================================================
# Data Properties
# ======================================================================

nexus:sessionId a owl:DatatypeProperty ;
    rdfs:label "sessionId"@en ;
    rdfs:range xsd:string .

nexus:userId a owl:DatatypeProperty ;
    rdfs:label "userId"@en ;
    rdfs:range xsd:string .
