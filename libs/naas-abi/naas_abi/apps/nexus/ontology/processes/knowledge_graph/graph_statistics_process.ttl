@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix nexus: <http://nexus.platform/ontology/> .


# ======================================================================
# Graph Statistics Process
# BFO 7 Buckets Compliant (ISO 21383-2)
# ======================================================================

nexus:graph_statistics_process a owl:Ontology ;
    dc:title "Graph Statistics Process"@en ;
    dc:description "A process that calculates workspace-level graph metrics including total nodes, total edges, type distributions, and average degree using SQL aggregate queries."@en ;
    dc:created "2026-02-09"^^xsd:date ;
    owl:imports <http://ontology.naas.ai/abi/BFO7Buckets> ,
                <http://nexus.platform/ontology/_shared/common_entities> .


# ======================================================================
# WHAT: Process (BFO_0000015)
# ======================================================================

nexus:GraphStatisticsProcess a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000015 ;
    rdfs:label "Graph Statistics Process"@en ;
    skos:definition "A process that calculates workspace-level graph metrics including total nodes, total edges, type distributions, and average degree using SQL aggregate queries."@en ;
    rdfs:comment "Implements: apps/api/app/api/endpoints/graph.py:361-400 get_graph_statistics()" ;
    skos:example "1. Validate workspace access\n2. SELECT COUNT(*) FROM graph_nodes WHERE workspace_id = ?\n3. SELECT COUNT(*) FROM graph_edges WHERE workspace_id = ?\n4. SELECT type, COUNT(*) FROM graph_nodes GROUP BY type\n5. SELECT type, COUNT(*) FROM graph_edges GROUP BY type\n6. Calculate avg_degree = 2 * total_edges / total_nodes\n7. Return statistics dict"@en .

# ======================================================================
# WHO: Material Entities (BFO_0000040)
# ======================================================================

nexus:StatisticsEngine a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "StatisticsEngine"@en ;
    skos:definition "SQL aggregate query executor"@en .

nexus:GraphDatabase a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "GraphDatabase"@en ;
    skos:definition "PostgreSQL with graph_nodes and graph_edges tables"@en .

# ======================================================================
# WHERE: Sites (BFO_0000029)
# ======================================================================

nexus:StatisticsEndpoint a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "StatisticsEndpoint"@en ;
    skos:definition "API endpoint GET /api/graph/statistics/{workspace_id}"@en .

# ======================================================================
# WHEN: Temporal Regions (BFO_0000008)
# ======================================================================

nexus:StatisticsDuration a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000008 ;
    rdfs:label "StatisticsDuration"@en ;
    skos:definition "50-200ms for 4 aggregate queries"@en .

# ======================================================================
# HOW WE KNOW: Information Entities (BFO_0000031)
# ======================================================================

nexus:StatisticsResult a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "StatisticsResult"@en ;
    skos:definition "Dict: total_nodes, total_edges, nodes_by_type, edges_by_type, avg_degree"@en .

nexus:TypeDistribution a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "TypeDistribution"@en ;
    skos:definition "Dict mapping type string to count integer"@en .

nexus:AverageDegree a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "AverageDegree"@en ;
    skos:definition "Float: 2 * total_edges / total_nodes (0 if no nodes)"@en .

# ======================================================================
# HOW IT IS: Qualities (BFO_0000019)
# ======================================================================

nexus:DegreeCalculation a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "DegreeCalculation"@en ;
    skos:definition "Quality: average degree formula = 2 * edges / nodes"@en .

nexus:EmptyGraphHandling a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "EmptyGraphHandling"@en ;
    skos:definition "Quality: returns 0 for all metrics when graph is empty"@en .

# ======================================================================
# WHY: Roles (BFO_0000023)
# ======================================================================

nexus:MetricsCollectorRole a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000023 ;
    rdfs:label "MetricsCollectorRole"@en ;
    skos:definition "Role realized when system aggregates graph statistics"@en .

# ======================================================================
# WHY: Dispositions (BFO_0000016)
# ======================================================================

nexus:SQLAggregateDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "SQLAggregateDisposition"@en ;
    skos:definition "Disposition to use SQL COUNT and GROUP BY for efficient statistics"@en .

# ======================================================================
# Process Relationships (BFO Object Properties)
# ======================================================================

nexus:graph_statistics_process_has_statisticsengine a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000057 ;
    rdfs:domain nexus:GraphStatisticsProcess ;
    rdfs:range nexus:StatisticsEngine ;
    rdfs:label "GraphStatisticsProcess has participant StatisticsEngine"@en .

nexus:graph_statistics_process_occurs_in a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000066 ;
    rdfs:domain nexus:GraphStatisticsProcess ;
    rdfs:range nexus:StatisticsEndpoint ;
    rdfs:label "GraphStatisticsProcess occurs in StatisticsEndpoint"@en .

nexus:graph_statistics_process_occupies a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000199 ;
    rdfs:domain nexus:GraphStatisticsProcess ;
    rdfs:range nexus:StatisticsDuration ;
    rdfs:label "GraphStatisticsProcess occupies StatisticsDuration"@en .

nexus:graph_statistics_process_realizes a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000055 ;
    rdfs:domain nexus:GraphStatisticsProcess ;
    rdfs:range nexus:MetricsCollectorRole ;
    rdfs:label "GraphStatisticsProcess realizes MetricsCollectorRole"@en .

# ======================================================================
# Data Properties
# ======================================================================

nexus:totalNodes a owl:DatatypeProperty ;
    rdfs:label "totalNodes"@en ;
    rdfs:range xsd:integer .

nexus:totalEdges a owl:DatatypeProperty ;
    rdfs:label "totalEdges"@en ;
    rdfs:range xsd:integer .

nexus:avgDegree a owl:DatatypeProperty ;
    rdfs:label "avgDegree"@en ;
    rdfs:range xsd:float .
