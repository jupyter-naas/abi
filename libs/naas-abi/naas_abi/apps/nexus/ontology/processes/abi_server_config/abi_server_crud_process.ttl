@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix bfo: <http://purl.obolibrary.org/obo/> .
@prefix nexus: <http://nexus.platform/ontology/> .


# ======================================================================
# ABI Server CRUD Process
# BFO 7 Buckets Compliant (ISO 21383-2)
# ======================================================================

nexus:abi_server_crud_process a owl:Ontology ;
    dc:title "ABI Server CRUD Process"@en ;
    dc:description "A process that manages external ABI (Agentic Brain Infrastructure) server configurations per workspace, including create, read, update, and delete operations on the abi_servers PostgreSQL table."@en ;
    dc:created "2026-02-09"^^xsd:date ;
    owl:imports <http://ontology.naas.ai/abi/BFO7Buckets> ,
                <http://nexus.platform/ontology/_shared/common_entities> .


# ======================================================================
# WHAT: Process (BFO_0000015)
# ======================================================================

nexus:ABIServerCRUDProcess a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000015 ;
    rdfs:label "ABI Server CRUD Process"@en ;
    skos:definition "A process that manages external ABI (Agentic Brain Infrastructure) server configurations per workspace, including create, read, update, and delete operations on the abi_servers PostgreSQL table."@en ;
    rdfs:comment "Implements: apps/api/app/api/endpoints/abi.py:65-205 list/create/get/update/delete_abi_server()" ;
    skos:example "1. List: SELECT FROM abi_servers WHERE workspace_id=?\n2. Create: validate endpoint uniqueness, generate ID abi-{uuid}, insert row\n3. Get: SELECT by server_id and workspace_id (404 if not found)\n4. Update: modify name/endpoint/api_key/enabled, set updated_at\n5. Delete: remove server row (agents remain in agent_configs)"@en .

# ======================================================================
# WHO: Material Entities (BFO_0000040)
# ======================================================================

nexus:ABIServerManager a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "ABIServerManager"@en ;
    skos:definition "Backend logic managing ABI server configurations"@en .

nexus:WorkspaceAdmin a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000040 ;
    rdfs:label "WorkspaceAdmin"@en ;
    skos:definition "Admin/owner user configuring ABI servers"@en .

# ======================================================================
# WHERE: Sites (BFO_0000029)
# ======================================================================

nexus:ABIEndpoints a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "ABIEndpoints"@en ;
    skos:definition "API endpoints /api/abi/workspaces/{id}/abi-servers/*"@en .

nexus:ABIServersTable a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000029 ;
    rdfs:label "ABIServersTable"@en ;
    skos:definition "PostgreSQL abi_servers table with workspace_id FK"@en .

# ======================================================================
# WHEN: Temporal Regions (BFO_0000008)
# ======================================================================

nexus:CRUDDuration a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000008 ;
    rdfs:label "CRUDDuration"@en ;
    skos:definition "30-60ms per operation"@en .

# ======================================================================
# HOW WE KNOW: Information Entities (BFO_0000031)
# ======================================================================

nexus:ABIServerCreate a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "ABIServerCreate"@en ;
    skos:definition "Pydantic model: name (1-255), endpoint (URL), api_key (optional)"@en .

nexus:ABIServerRecord a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "ABIServerRecord"@en ;
    skos:definition "DB row: id (abi-{uuid}), workspace_id, name, endpoint, api_key, enabled, timestamps"@en .

nexus:ABIServerUpdate a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000031 ;
    rdfs:label "ABIServerUpdate"@en ;
    skos:definition "Partial update: name, endpoint, api_key, enabled"@en .

# ======================================================================
# HOW IT IS: Qualities (BFO_0000019)
# ======================================================================

nexus:EndpointUniqueness a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "EndpointUniqueness"@en ;
    skos:definition "Quality: unique(workspace_id, endpoint) prevents duplicate server configs"@en .

nexus:APIKeyStorage a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000019 ;
    rdfs:label "APIKeyStorage"@en ;
    skos:definition "Quality: api_key stored in plaintext (TODO: encrypt with Fernet)"@en .

# ======================================================================
# WHY: Roles (BFO_0000023)
# ======================================================================

nexus:ServerConfiguratorRole a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000023 ;
    rdfs:label "ServerConfiguratorRole"@en ;
    skos:definition "Role realized when admin configures external ABI server connections"@en .

# ======================================================================
# WHY: Dispositions (BFO_0000016)
# ======================================================================

nexus:CascadeDeleteDisposition a owl:Class ;
    rdfs:subClassOf bfo:BFO_0000016 ;
    rdfs:label "CascadeDeleteDisposition"@en ;
    skos:definition "Disposition to cascade delete when workspace is deleted"@en .

# ======================================================================
# Process Relationships (BFO Object Properties)
# ======================================================================

nexus:abi_server_crud_process_has_abiservermanager a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000057 ;
    rdfs:domain nexus:ABIServerCRUDProcess ;
    rdfs:range nexus:ABIServerManager ;
    rdfs:label "ABIServerCRUDProcess has participant ABIServerManager"@en .

nexus:abi_server_crud_process_occurs_in a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000066 ;
    rdfs:domain nexus:ABIServerCRUDProcess ;
    rdfs:range nexus:ABIEndpoints ;
    rdfs:label "ABIServerCRUDProcess occurs in ABIEndpoints"@en .

nexus:abi_server_crud_process_occupies a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000199 ;
    rdfs:domain nexus:ABIServerCRUDProcess ;
    rdfs:range nexus:CRUDDuration ;
    rdfs:label "ABIServerCRUDProcess occupies CRUDDuration"@en .

nexus:abi_server_crud_process_realizes a owl:ObjectProperty ;
    rdfs:subPropertyOf bfo:BFO_0000055 ;
    rdfs:domain nexus:ABIServerCRUDProcess ;
    rdfs:range nexus:ServerConfiguratorRole ;
    rdfs:label "ABIServerCRUDProcess realizes ServerConfiguratorRole"@en .

# ======================================================================
# Data Properties
# ======================================================================

nexus:serverName a owl:DatatypeProperty ;
    rdfs:label "serverName"@en ;
    rdfs:range xsd:string .

nexus:serverEndpoint a owl:DatatypeProperty ;
    rdfs:label "serverEndpoint"@en ;
    rdfs:range xsd:string .

nexus:isEnabled a owl:DatatypeProperty ;
    rdfs:label "isEnabled"@en ;
    rdfs:range xsd:boolean .
